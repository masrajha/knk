#include <stdio.h>
#include <stdlib.h>
#include <pthread.h>
#include <math.h>
#include <time.h>
#include <chrono>
#include <iostream>

#define num_thread 2
#define num_sum 1.e+9

// pthread_t tid1;
// pthread_t tid2;

pthread_t tid[num_thread];

void *Sum(void *arg)	//Sum(0), Sum(1), Sum(2), Sum(3)
{
    int myid = (int)(long long) arg;
    //printf(" myid %d \n", myid);
    // clock_t start, end;
    double time_dif=0;

    
	unsigned long int i;
	unsigned long int sum=0;
	unsigned long int range = floor(num_sum/num_thread);//jika ada 4 thread dan 10^7 data maka tiap thread sum(2.500.000)
	
    auto start = std::chrono::high_resolution_clock::now();
	for (i=myid*range; i< myid*range+range;i++)	//change this size and see the time execution in each thread.
												//compare to the serial summation.
		sum+=i;
    auto end = std::chrono::high_resolution_clock::now();
    // auto duration = std::chrono::duration_cast<std::chrono::microseconds>(end - start);
    auto duration = std::chrono::duration_cast<std::chrono::microseconds>(end - start);
    
    // printf("Thread ID: %d, range=%ld, sum=%ld start:%ld end:%ld dif:%f\n", myid, range, sum, start, end, time_dif);
    // std::cout << "Thread ID: " << myid << ", range=" << range << ", sum=" << sum 
    //           << ", start=" << start.time_since_epoch().count()
    //           << ", end=" << end.time_since_epoch().count()
    //           << ", time=" << duration.count()/1000000.0 << " micro seconds" << std::endl;
    return NULL;
}
 
int main()
{
	int i;
    long int n[]={0,1,2,3};
    
    auto start = std::chrono::high_resolution_clock::now();
    
    for (i = 0; i < num_thread; i++){
        pthread_create(&tid[i], NULL, &Sum, (void *) (long long)i);		//Sum(0), Sum(1), Sum(2), Sum(3)
    }
    
    for (i = 0; i < num_thread; i++){
		pthread_join(tid[i],NULL);
	}

    auto end = std::chrono::high_resolution_clock::now();
    auto paralel_duration = std::chrono::duration_cast<std::chrono::microseconds>(end - start);
    double paralel_time = paralel_duration.count()/1000000.0;
    std::cout << "Paralel time summary: start=" << start.time_since_epoch().count()
              << ", end=" << end.time_since_epoch().count()
              << ", time=" << paralel_time << " micro seconds" << std::endl;
    
    start = std::chrono::high_resolution_clock::now();
    unsigned long int serial_sum =0;
    for (unsigned long int j=0; j< num_sum; j++){
        serial_sum+=j;
    }
    end = std::chrono::high_resolution_clock::now();
    auto serial_duration = std::chrono::duration_cast<std::chrono::microseconds>(end - start);
    double serial_time = serial_duration.count()/1000000.0;              
            
    std::cout << "Serial time summary: start=" << start.time_since_epoch().count()
              << ", end=" << end.time_since_epoch().count()
              << ", time=" << serial_time<< " micro seconds" << std::endl;

    // pthread_join(tid1,NULL);
	// pthread_join(tid2,NULL);
    
    pthread_exit(NULL);
    return 0; 
}
